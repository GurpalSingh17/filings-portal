<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Selected Data – filings-portal</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- PapaParse -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"
          integrity="sha512-3mnKvzoQjpUkf3omYEGFJPUA1S3Yt5pGmX1P5JU+CbN1LjzbuILp+o6ti+awhXxgZSQp2I2poV4Mn+J81U2c1A=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- DataTables CSS & JS + Buttons extension -->
  <link rel="stylesheet"
        href="https://cdn.datatables.net/v/bs5/dt-1.13.4/b-2.3.6/datatables.min.css"/>
  <script src="https://cdn.datatables.net/v/bs5/dt-1.13.4/b-2.3.6/datatables.min.js"></script>

  <style>
    body { font-family: sans-serif; padding: 20px; }
    nav a { margin-right: 15px; }
    #filings_filter, #filings_length { margin-left: 0; display: inline-block; }
  </style>
</head>
<body>

  <nav>
    <a href="index.html">Home</a> |
    <a href="selected.html"><strong>Selected Data</strong></a>
  </nav>

  <h1>The Stuff We Actually Need</h1>

  <label>
    Filter by Filings:
    <select id="typeFilter" multiple size="6" style="width:200px"></select>
  </label>

  <table id="filings" class="display" style="width:100%; margin-top:10px">
    <thead><tr></tr></thead>
  </table>

  <script>
  $(function(){
    Papa.parse('filtered_with_parsed.csv', {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        var data   = results.data,
            fields = results.meta.fields,
            seen    = {};

        // Build the Filings‐Type dropdown
        data.forEach(function(r){
          var t = r.Type;
          if(t && !seen[t]) { seen[t] = true; $('#typeFilter').append(
            $('<option>').text(t).val(t)
          ); }
        });
        $('#typeFilter').prepend( $('<option>').text('All').val('All') );
        $('#typeFilter').on('change', applyFilter);

        // Prepare DataTables columns, with renderers for links
        var cols = fields.map(function(name){
          var col = { title: name, data: name, defaultContent: "" };
          if(name==='Link' || name==='Source File' || name==='Parsed CSV'){
            col.render = function(val){
              return val
                ? '<a href="'+val+'" target="_blank" rel="noopener">'+val+'</a>'
                : '';
            };
          }
          return col;
        });

        // Initialize DataTable
        var table = $('#filings').DataTable({
          data: data,
          columns: cols,
          pageLength: 25,
          dom: 'Bfrtip',
          buttons: [
            { extend: 'csvHtml5', text: 'Download CSV',
              exportOptions:{ modifier:{ search:'applied' }}},
            { extend: 'excelHtml5', text: 'Download Excel',
              exportOptions:{ modifier:{ search:'applied' }}}
          ]
        });

        function applyFilter(){
          var vals = $('#typeFilter').val()||[];
          if(vals.includes('All') || vals.length===0){
            table
              .columns(fields.indexOf('Type'))
              .search('')
              .draw();
          } else {
            // build regex OR list: ^(A|B|C)$
            var rx = '^(' + vals.map(v=>v.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&')).join('|') + ')$';
            table
              .columns(fields.indexOf('Type'))
              .search(rx, true, false)
              .draw();
          }
        }
      }
    });
  });
  </script>

</body>
</html>
