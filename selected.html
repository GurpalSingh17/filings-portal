<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Selected Data</title>
  <!-- DataTables CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
  />
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <!-- PapaParse -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    header { margin-bottom: 1rem; }
    nav a { margin-right: 1rem; }
    #filters { margin-bottom: .5rem; }
  </style>
</head>
<body>
  <header>
    <h1>The Stuff We Actually Need</h1>
    <nav>
      <a href="index.html">Home</a>|
      <a href="selected.html">Selected Data</a>
    </nav>
  </header>

  <div id="filters">
    <label>Filter by Filings:
      <select id="filingFilter" multiple size="6" style="min-width:180px;"></select>
    </label>
  </div>

  <table id="selected" class="display" style="width:100%">
    <thead><tr></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    let table;

    Papa.parse('filtered_with_parsed.csv', {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;
        const fields = results.meta.fields;

        // build table columns
        const columns = fields.map(f => ({
          title: f,
          data: f,
          render: (d, _, __, meta) => {
            // make links clickable
            if (f === 'Link' || f === 'Source File' || f === 'Parsed CSV') {
              return `<a href="${d}" target="_blank">${d}</a>`;
            }
            return d;
          }
        }));

        // init DataTable
        table = $('#selected').DataTable({
          data: data,
          columns: columns,
          pageLength: 25,
          order: []
        });

        // populate filings multi-select
        const types = Array.from(new Set(data.map(r => r.Type))).sort();
        const $sel = $('#filingFilter');
        $sel.append('<option value="">(all)</option>');
        types.forEach(t => $sel.append(`<option>${t}</option>`));

        // filter on change
        $sel.on('change', function() {
          const vals = $(this).val() || [];
          if (vals.includes('') || vals.length === 0) {
            table.column(fields.indexOf('Type')).search('').draw();
          } else {
            const regex = vals.map(v=> `^${v}$`).join('|');
            table.column(fields.indexOf('Type')).search(regex, true, false).draw();
          }
        });
      }
    });
  </script>
</body>
</html>
