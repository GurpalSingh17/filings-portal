<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Filings Portal</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    nav a { margin-right: 1rem; text-decoration: none; }
    nav a.active { font-weight: bold; text-decoration: underline; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background: #f5f5f5; }
    .muted { color:#666; font-size:.9rem; margin-left:.5rem; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
</head>
<body>
  <nav>
    <a href="index.html" class="active">Home</a>
    <a href="selected.html">Selected Data</a>
    <a href="final.html">Final Output</a>
    <a href="blackstone-ciks.html">Blackstone &amp; CIKs</a>
  </nav>

  <h1>All Filings</h1>
  <input type="text" id="filter-input" placeholder="Type filing type to filter…" />
  <span id="status" class="muted"></span>

  <table id="data-table"></table>

  <script>
    // Try these root-level CSVs in order. We’ll use the first that loads.
    const CANDIDATES = [
      'filtered_with_parsed.csv',
      'filtered_with_source.csv',
      'final_output_for_xml.csv',
      'CLEANED_final_output_for_xml.csv',
      'NEW_filing_links.csv',
      'example_of_final_output.csv',
      'filtered_filings.csv' // fallback to your old name, just in case
    ];

    const $status = document.getElementById('status');

    (async function loadAny() {
      for (const name of CANDIDATES) {
        try {
          const res = await fetch(name);
          if (!res.ok) continue;              // 404? try next
          const text = await res.text();
          $status.textContent = `(source: ${name})`;
          const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
          window.ALL_DATA = parsed.data;
          renderTable(window.ALL_DATA);
          return;
        } catch(e) { /* try next */ }
      }
      document.getElementById('data-table').innerHTML =
        '<tr><td>No CSV found at repo root.</td></tr>';
      $status.textContent = '';
    })();

    // Filter as the user types
    document.getElementById('filter-input').addEventListener('input', function(e) {
      const term = e.target.value.toLowerCase();
      const filtered = (window.ALL_DATA || []).filter(r =>
        r.Filings && String(r.Filings).toLowerCase().includes(term)
      );
      renderTable(filtered);
    });

    // Table rendering
    function renderTable(data) {
      const tbl = document.getElementById('data-table');
      tbl.innerHTML = '';
      if (!data || !data.length) {
        tbl.innerHTML = '<tr><td colspan="5">No rows to display.</td></tr>';
        return;
      }
      const headerRow = document.createElement('tr');
      Object.keys(data[0]).forEach(k => {
        const th = document.createElement('th');
        th.textContent = k;
        headerRow.appendChild(th);
      });
      tbl.appendChild(headerRow);

      data.forEach(row => {
        const tr = document.createElement('tr');
        Object.values(row).forEach(v => {
          const td = document.createElement('td');
          td.textContent = v;
          tr.appendChild(td);
        });
        tbl.appendChild(tr);
      });
    }
  </script>
</body>
</html>
